{"version":3,"file":"svg.panzoom.min.js","sources":["../src/svg.panzoom.js"],"sourcesContent":["import { Svg, on, off, extend, Matrix, Box } from '@svgdotjs/svg.js'\n\r\nconst normalizeEvent = (ev) =>\r\n  ev.touches || [{ clientX: ev.clientX, clientY: ev.clientY }]\r\n\r\nextend(Svg, {\r\n  panZoom (options) {\r\n    this.off('.panZoom')\r\n\r\n    // when called with false, disable panZoom\r\n    if (options === false) return this\r\n\r\n    options = options || {}\r\n    const zoomFactor = options.zoomFactor || 0.03\r\n    const zoomMin = options.zoomMin || Number.MIN_VALUE\r\n    const zoomMax = options.zoomMax || Number.MAX_VALUE\r\n\r\n    let lastP; let lastTouches; let zoomInProgress = false\r\n\r\n    var wheelZoom = function (ev) {\r\n      ev.preventDefault()\r\n\r\n      // touchpads can give ev.deltaY == 0, which skrews the lvl calculation\r\n      if (ev.deltaY === 0) return\r\n\r\n      let lvl = this.zoom() - zoomFactor * ev.deltaY / Math.abs(ev.deltaY)\r\n      const p = this.point(ev.clientX, ev.clientY)\r\n\r\n      if (lvl > zoomMax) { lvl = zoomMax }\r\n\r\n      if (lvl < zoomMin) { lvl = zoomMin }\r\n\r\n      if (this.dispatch('zoom', { level: lvl, focus: p }).defaultPrevented) { return this }\r\n\r\n      this.zoom(lvl, p)\r\n    }\r\n\r\n    const pinchZoomStart = function (ev) {\r\n      lastTouches = normalizeEvent(ev)\r\n\r\n      if (lastTouches.length < 2) return\r\n      ev.preventDefault()\r\n\r\n      if (this.dispatch('pinchZoomStart', { event: ev }).defaultPrevented) { return }\r\n\r\n      this.off('touchstart.panZoom', pinchZoomStart)\r\n\r\n      zoomInProgress = true\r\n      on(document, 'touchmove.panZoom', pinchZoom, this, { passive: false })\r\n      on(document, 'touchend.panZoom', pinchZoomStop, this, { passive: false })\r\n    }\r\n\r\n    const pinchZoomStop = function (ev) {\r\n      ev.preventDefault()\r\n      zoomInProgress = false\r\n\r\n      this.dispatch('pinchZoomEnd', { event: ev })\r\n\r\n      off(document, 'touchmove.panZoom', pinchZoom)\r\n      off(document, 'touchend.panZoom', pinchZoomStop)\r\n      this.on('touchstart.panZoom', pinchZoomStart)\r\n    }\r\n\r\n    const pinchZoom = function (ev) {\r\n      ev.preventDefault()\r\n\r\n      const currentTouches = normalizeEvent(ev)\r\n      const zoom = this.zoom()\r\n\r\n      // Distance Formula\r\n      const lastDelta = Math.sqrt(\r\n        Math.pow(lastTouches[0].clientX - lastTouches[1].clientX, 2)\r\n        + Math.pow(lastTouches[0].clientY - lastTouches[1].clientY, 2)\r\n      )\r\n\r\n      const currentDelta = Math.sqrt(\r\n        Math.pow(currentTouches[0].clientX - currentTouches[1].clientX, 2)\r\n        + Math.pow(currentTouches[0].clientY - currentTouches[1].clientY, 2)\r\n      )\r\n\r\n      let zoomAmount = lastDelta / currentDelta\r\n\r\n      if ((zoom < zoomMin && zoomAmount > 1) || (zoom > zoomMax && zoomAmount < 1)) {\r\n        zoomAmount = 1\r\n      }\r\n\r\n      const currentFocus = {\r\n        x: currentTouches[0].clientX + 0.5 * (currentTouches[1].clientX - currentTouches[0].clientX),\r\n        y: currentTouches[0].clientY + 0.5 * (currentTouches[1].clientY - currentTouches[0].clientY)\r\n      }\r\n\r\n      const lastFocus = {\r\n        x: lastTouches[0].clientX + 0.5 * (lastTouches[1].clientX - lastTouches[0].clientX),\r\n        y: lastTouches[0].clientY + 0.5 * (lastTouches[1].clientY - lastTouches[0].clientY)\r\n      }\r\n\r\n      const p = this.point(currentFocus.x, currentFocus.y)\r\n      const focusP = this.point(2 * currentFocus.x - lastFocus.x, 2 * currentFocus.y - lastFocus.y)\r\n      const box = new Box(this.viewbox()).transform(\r\n        new Matrix()\r\n          .translate(p.x, p.y)\r\n          .scale(zoomAmount, 0, 0)\r\n          .translate(-focusP.x, -focusP.y)\r\n      )\r\n\r\n      this.viewbox(box)\r\n\r\n      lastTouches = currentTouches\r\n\r\n      this.dispatch('zoom', { box: box, focus: focusP })\r\n    }\r\n\r\n    const panStart = function (ev) {\r\n      ev.preventDefault()\r\n\r\n      this.off('mousedown.panZoom', panStart)\r\n\r\n      lastTouches = normalizeEvent(ev)\r\n\r\n      if (zoomInProgress) return\r\n\r\n      this.dispatch('panStart', { event: ev })\r\n\r\n      lastP = { x: lastTouches[0].clientX, y: lastTouches[0].clientY }\r\n\r\n      on(document, 'mousemove.panZoom', panning, this)\r\n      on(document, 'mouseup.panZoom', panStop, this)\r\n    }\r\n\r\n    const panStop = function (ev) {\r\n      ev.preventDefault()\r\n\r\n      off(document, 'mousemove.panZoom', panning)\r\n      off(document, 'mouseup.panZoom', panStop)\r\n      this.on('mousedown.panZoom', panStart)\r\n\r\n      this.dispatch('panEnd', { event: ev })\r\n    }\r\n\r\n    const panning = function (ev) {\r\n      ev.preventDefault()\r\n\r\n      const currentTouches = normalizeEvent(ev)\r\n\r\n      const currentP = { x: currentTouches[0].clientX, y: currentTouches[0].clientY }\r\n\r\n      const p1 = this.point(currentP.x, currentP.y)\r\n\r\n      const p2 = this.point(lastP.x, lastP.y)\r\n\r\n      const deltaP = [p2.x - p1.x, p2.y - p1.y]\r\n\r\n      const box = new Box(this.viewbox()).transform(new Matrix().translate(deltaP[0], deltaP[1]))\r\n\r\n      this.viewbox(box)\r\n      lastP = currentP\r\n    }\r\n\r\n    this.on('wheel.panZoom', wheelZoom)\r\n    this.on('touchstart.panZoom', pinchZoomStart, this, { passive: false })\r\n    this.on('mousedown.panZoom', panStart, this)\r\n\r\n    return this\r\n  }\r\n})\r\n"],"names":["normalizeEvent","ev","touches","clientX","clientY","Svg","panZoom","options","off","this","lastP","lastTouches","zoomFactor","zoomMin","Number","MIN_VALUE","zoomMax","MAX_VALUE","zoomInProgress","pinchZoomStart","length","preventDefault","dispatch","event","defaultPrevented","on","document","pinchZoom","passive","pinchZoomStop","currentTouches","zoom","zoomAmount","Math","sqrt","pow","currentFocus","x","y","lastFocus","p","point","focusP","box","Box","viewbox","transform","Matrix","translate","scale","focus","panStart","panning","panStop","currentP","p1","p2","deltaP","deltaY","lvl","abs","level"],"mappings":"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"}